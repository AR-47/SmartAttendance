<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Monitor - Smart Attendance</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        .live-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .live-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .live-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border-radius: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        .live-badge.active {
            background: rgba(16, 185, 129, 0.2);
            color: #4ade80;
        }
        .live-dot {
            width: 10px;
            height: 10px;
            background: currentColor;
            border-radius: 50%;
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-card h2 {
            font-size: 36px;
            margin: 0;
            color: #38bdf8;
        }
        .stat-card p {
            margin: 10px 0 0 0;
            color: #94a3b8;
        }
        .stat-card.present h2 { color: #4ade80; }
        .stat-card.absent h2 { color: #f87171; }
        .attendance-list {
            background: linear-gradient(145deg, #0f172a, #1e293b);
            border-radius: 12px;
            overflow: hidden;
        }
        .attendance-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            padding: 15px 20px;
            border-bottom: 1px solid #334155;
        }
        .attendance-row.header {
            background: #1e293b;
            font-weight: 600;
            color: #38bdf8;
        }
        .attendance-row:last-child {
            border-bottom: none;
        }
        .status-present {
            color: #4ade80;
            font-weight: 600;
        }
        .status-absent {
            color: #f87171;
            font-weight: 600;
        }
        .no-data {
            padding: 50px;
            text-align: center;
            color: #64748b;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Live Attendance Monitor</h1>
        <p>Real-time face recognition attendance</p>
        <nav class="nav-links">
            <a href="/login">Login</a>
        </nav>
    </div>

    <div class="dashboard-content">
        <div class="live-container">
            <div class="live-header">
                <h2 class="section-title">Current Session</h2>
                <div class="live-badge" id="liveBadge">
                    <span class="live-dot"></span>
                    <span id="statusText">Checking...</span>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <h2 id="totalCount">0</h2>
                    <p>Total Detected</p>
                </div>
                <div class="stat-card present">
                    <h2 id="presentCount">0</h2>
                    <p>Present</p>
                </div>
                <div class="stat-card absent">
                    <h2 id="absentCount">0</h2>
                    <p>Absent</p>
                </div>
            </div>

            <div class="attendance-list">
                <div class="attendance-row header">
                    <span>Name</span>
                    <span>Entry</span>
                    <span>Exit</span>
                    <span>Duration</span>
                    <span>Status</span>
                </div>
                <div id="attendanceData">
                    <div class="no-data">
                        Waiting for attendance data...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function fetchLiveData() {
            fetch('/api/live')
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById('attendanceData');
                    const badge = document.getElementById('liveBadge');
                    const statusText = document.getElementById('statusText');
                    
                    if (data.length > 0) {
                        badge.classList.add('active');
                        statusText.textContent = 'LIVE';
                        
                        let present = 0, absent = 0;
                        let html = '';
                        
                        data.forEach(row => {
                            if (row.status === 'Present') present++;
                            else absent++;
                            
                            html += `
                                <div class="attendance-row">
                                    <span>${row.name}</span>
                                    <span>${row.face_entry || '-'}</span>
                                    <span>${row.face_exit || '-'}</span>
                                    <span>${row.duration ? row.duration.toFixed(1) + ' min' : '-'}</span>
                                    <span class="status-${row.status.toLowerCase()}">${row.status}</span>
                                </div>
                            `;
                        });
                        
                        container.innerHTML = html;
                        document.getElementById('totalCount').textContent = data.length;
                        document.getElementById('presentCount').textContent = present;
                        document.getElementById('absentCount').textContent = absent;
                    } else {
                        badge.classList.remove('active');
                        statusText.textContent = 'IDLE';
                        container.innerHTML = '<div class="no-data">No active session. Waiting for class to start...</div>';
                        document.getElementById('totalCount').textContent = '0';
                        document.getElementById('presentCount').textContent = '0';
                        document.getElementById('absentCount').textContent = '0';
                    }
                })
                .catch(err => {
                    console.error('Error fetching data:', err);
                });
        }

        // Fetch immediately and then every 3 seconds
        fetchLiveData();
        setInterval(fetchLiveData, 3000);
    </script>
</body>
</html>
